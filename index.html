<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>è’‹ä¸€å‡¡ä¸“å±é¡µé¢ | ç½‘ç»œéŸ³ä¹ç‰ˆ</title>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    background: #000;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    overflow: hidden;
    touch-action: manipulation;
    font-family: "Microsoft YaHei", sans-serif;
  }
  #particles-js { position: fixed; width: 100%; height: 100%; z-index: 0; }
  .audio-wave {
    width: 260px;
    height: 260px;
    border-radius: 50%;
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
    animation: breathe 3s ease-in-out infinite;
    z-index: 1;
  }
  .audio-wave.active { animation: pulse 0.5s ease infinite alternate; }
  @keyframes breathe {
    0%, 100% { box-shadow: 0 0 0 5px rgba(255, 51, 51, 0.3); }
    50% { box-shadow: 0 0 0 20px rgba(255, 51, 51, 0.2); }
  }
  @keyframes pulse {
    0% { transform: scale(1); opacity: 0.8; }
    100% { transform: scale(1.1); opacity: 1; }
  }
  .avatar {
    width: 220px;
    height: 220px;
    border-radius: 50%;
    border: 5px solid #ff3333;
    object-fit: cover;
    position: absolute;
    z-index: 2;
    animation: rotate 20s linear infinite;
    cursor: pointer;
  }
  @keyframes rotate { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
  .play-btn {
    margin-top: 40px;
    padding: 12px 30px;
    font-size: 18px;
    background: #ff3333;
    color: #fff;
    border: none;
    border-radius: 50px;
    cursor: pointer;
    box-shadow: 0 0 15px #ff3333;
    transition: 0.3s;
    z-index: 3;
    position: relative;
    -webkit-tap-highlight-color: transparent;
  }
  .play-btn:hover { background: #ff6666; transform: scale(1.05); }
  .music-switch-btn {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: #333;
    color: #fff;
    border: 2px solid #ff3333;
    font-size: 20px;
    cursor: pointer;
    transition: 0.3s;
    z-index: 3;
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
    -webkit-tap-highlight-color: transparent;
  }
  .music-switch-btn:hover {
    background: #ff3333;
    transform: scale(1.1);
  }
  .music-control-group {
    display: flex;
    align-items: center;
    gap: 15px;
  }
  .music-name {
    color: #fff;
    margin-top: 15px;
    font-size: 16px;
    z-index: 3;
    position: relative;
    text-align: center;
    max-width: 80%;
  }
</style>
</head>
<body>
  <div id="particles-js"></div>
  <div class="audio-wave" id="wave">
    <img src="avatar.jpg" alt="è’‹ä¸€å‡¡å¤´åƒ" class="avatar" id="avatar">
  </div>
  <div class="music-control-group">
    <button class="music-switch-btn" onclick="switchMusic('prev')">â†</button>
    <button class="play-btn" onclick="toggleMusic()" id="btn">åŠ è½½æ­Œå•ä¸­...</button>
    <button class="music-switch-btn" onclick="switchMusic('next')">â†’</button>
  </div>
  <div class="music-name" id="musicName">è¯·ç¨å€™...</div>

  <!-- ä¿®å¤ç‚¹ï¼šè¿™é‡Œå¿…é¡»æ­£ç¡®é—­åˆæ ‡ç­¾ï¼ -->
  <audio id="bgm" preload="auto">
    <source src="" type="audio/mpeg" id="audioSource">
    æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒéŸ³é¢‘æ’­æ”¾
  

  <script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
  <script>
    // --- ç²’å­ç‰¹æ•ˆåˆå§‹åŒ– ---
    particlesJS("particles-js", {
      "particles": {
        "number": { "value": 80, "density": { "enable": true, "value_area": 800 } },
        "color": { "value": "#ff3333" },
        "shape": { "type": "circle" },
        "opacity": { "value": 0.5, "random": true },
        "size": { "value": 3, "random": true },
        "line_linked": {
          "enable": true, "distance": 150, "color": "#ff3333", "opacity": 0.2, "width": 1
        },
        "move": {
          "enable": true, "speed": 1, "direction": "none", "random": true,
          "straight": false, "out_mode": "out", "bounce": false
        }
      },
      "interactivity": {
        "detect_on": "canvas",
        "events": {
          "onhover": { "enable": true, "mode": "grab" },
          "onclick": { "enable": true, "mode": "push" },
          "resize": true
        }
      },
      "retina_detect": true
    });

    // --- å…¨å±€å˜é‡ ---
    const audio = document.getElementById('bgm');
    const audioSource = document.getElementById('audioSource');
    const btn = document.getElementById('btn');
    const wave = document.getElementById('wave');
    const musicNameEl = document.getElementById('musicName');
    const avatarEl = document.getElementById('avatar');
    
    let musicList = []; // ä»ç½‘ç»œåŠ è½½çš„æ­Œå•
    let currentMusicIndex = 0;
    let isPlaying = false;
    let animationId;

    // --- 1. åŠ è½½ç½‘ç»œéŸ³ä¹æº ---
    const musicJsonUrl = "https://13413.kstore.vip/QingMusic/music.json";
    
    fetch(musicJsonUrl)
      .then(response => {
        if (!response.ok) throw new Error("ç½‘ç»œé”™è¯¯");
        return response.json();
      })
      .then(data => {
        // å‡è®¾ JSON ç»“æ„æ˜¯ { "list": [{ "name": "æ­Œå", "url": "é“¾æ¥" }, ...] }
        // å¦‚æœç»“æ„ä¸åŒï¼Œéœ€è¦æ ¹æ®å®é™…è¿”å›æ•°æ®è°ƒæ•´ä¸‹é¢çš„é”®å
        if (data.list && data.list.length > 0) {
          musicList = data.list;
          // åˆå§‹åŒ–ç¬¬ä¸€é¦–æ­Œ
          loadMusic(0);
          btn.innerText = `ç‚¹å‡»æ’­æ”¾ ${musicList[0].name}`;
        } else {
          throw new Error("æ­Œå•ä¸ºç©ºæˆ–æ ¼å¼é”™è¯¯");
        }
      })
      .catch(error => {
        btn.innerText = "åŠ è½½å¤±è´¥";
        musicNameEl.innerText = "è¯·æ£€æŸ¥ç½‘ç»œæˆ–é“¾æ¥";
        console.error("åŠ è½½æ­Œå•å‡ºé”™:", error);
      });

    // --- 2. åŠ è½½æŒ‡å®šç´¢å¼•çš„éŸ³ä¹ ---
    function loadMusic(index) {
      if (!musicList || musicList.length === 0) return;
      
      const newMusic = musicList[index];
      audioSource.src = newMusic.url; // å¯¹åº” JSON é‡Œçš„ url å­—æ®µ
      audio.load();
      musicNameEl.innerText = `å½“å‰æ›²ç›®ï¼š${newMusic.name}`; // å¯¹åº” JSON é‡Œçš„ name å­—æ®µ
    }

    // --- 3. æ ¸å¿ƒæ’­æ”¾æ§åˆ¶ ---
    function toggleMusic() {
      // å¦‚æœæ­Œå•æ²¡åŠ è½½å¥½ï¼Œç›´æ¥è¿”å›
      if (!musicList || musicList.length === 0) {
        alert("æ­Œå•è¿˜æ²¡åŠ è½½å¥½ï¼Œè¯·ç¨ç­‰ï¼");
        return;
      }

      if (isPlaying) {
        // æš‚åœ
        audio.pause();
        btn.innerText = `ç‚¹å‡»æ’­æ”¾ ${musicList[currentMusicIndex].name}`;
        wave.classList.remove('active');
        cancelAnimationFrame(animationId);
      } else {
        // æ’­æ”¾
        audio.play().then(() => {
          btn.innerText = `æ­£åœ¨æ’­æ”¾... (ç‚¹å‡»æš‚åœ)`;
          wave.classList.add('active');
          simulateWave();
        }).catch(err => {
          // æµè§ˆå™¨æ‹¦æˆªï¼Œå¼•å¯¼è§£é”
          btn.innerText = "ç‚¹å‡»å±å¹•ä»»æ„å¤„è§£é”";
          document.body.addEventListener('click', function unlockOnce() {
            audio.play().then(() => {
              btn.innerText = `æ­£åœ¨æ’­æ”¾... (ç‚¹å‡»æš‚åœ)`;
              wave.classList.add('active');
              simulateWave();
            });
          }, { once: true });
        });
      }
      isPlaying = !isPlaying;
    }

    // --- 4. åˆ‡æ¢æ­Œæ›² ---
    function switchMusic(type) {
      if (!musicList || musicList.length === 0) return;
      
      // åœæ­¢å½“å‰æ’­æ”¾
      if (isPlaying) {
        audio.pause();
        wave.classList.remove('active');
        cancelAnimationFrame(animationId);
        isPlaying = false;
      }

      // è®¡ç®—æ–°ç´¢å¼•
      if (type === 'prev') {
        currentMusicIndex = (currentMusicIndex - 1 + musicList.length) % musicList.length;
      } else {
        currentMusicIndex = (currentMusicIndex + 1) % musicList.length;
      }

      // åŠ è½½å¹¶æ›´æ–°UI
      loadMusic(currentMusicIndex);
      btn.innerText = `ç‚¹å‡»æ’­æ”¾ ${musicList[currentMusicIndex].name}`;
    }

    // --- 5. åŠ¨ç”»æ•ˆæœ ---
    function simulateWave() {
      if (!isPlaying) return;
      const randomSize = Math.random() * 15 + 10;
      wave.style.boxShadow = `0 0 0 ${randomSize}px rgba(255, 51, 51, 0.5)`;
      animationId = requestAnimationFrame(simulateWave);
    }

    // --- 6. å¤´åƒç‚¹å‡»å½©è›‹ ---
    avatarEl.onclick = function() {
      const tip = document.createElement('div');
      tip.innerText = 'ğŸ˜‹ å°å“¥å“¥';
      tip.style.cssText = `
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: 30px;
        color: #ff3333;
        z-index: 999;
        opacity: 1;
        transition: opacity 2s ease-out;
      `;
      document.body.appendChild(tip);
      setTimeout(() => {
        tip.style.opacity = 0;
        setTimeout(() => document.body.removeChild(tip), 2000);
      }, 100);
    };

    // --- 7. é”™è¯¯å¤„ç† ---
    audio.addEventListener('error', () => {
      btn.innerText = `æ’­æ”¾å¤±è´¥`;
      musicNameEl.innerText = `è¯·æ£€æŸ¥éŸ³é¢‘é“¾æ¥æ˜¯å¦æœ‰æ•ˆ`;
    });
  </script>
</body>
</html>
